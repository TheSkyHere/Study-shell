# //配置 6321/1512  CheckBusy实现见之前邮件

# 1. PPU模式下测试: HW上将 1512 SMI接到 6321对应口上SMI_PHY，同时1512对应的PhyAddr应该为0 
# 2. 建议 暂时不做VLAN/ ARP风暴等其他功能追加 
# 3. 建议先 手动或者脚本化执行下列cmd, 先确保cmd执行可以正常link/ping通后 再做压测 
# 4. 提供以下log： 配置6321/1512执行 cfg.txt  --> log1.txt
# 5. 		正常link/ping通后运行dump.txt--> log2.txt
# 6. 		压测 可能发生故障后现场保留并dump.txt -->log3.txt
# 7. 1512 Page[18] set mode to: SGMII 2 Copper...



gpiocli --shadow MDC_SW_BMC_SEL_N set-direction out
gpiocli --shadow MDC_SW_BMC_SEL_N set-value 0 

sleep 0.1
#  rw 0x1c 0x19 0x0012
#  rw 0x1c 0x18 0xb416
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0012
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb416


sleep 0.1
#  rw 0x1c 0x19 
#  rw 0x1c 0x18 
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x8001
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb414

sleep 0.1
#  rw 0x1c 0x18 0xb814
#  rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb814
mdio-util -m 1 -p 0x1c -r 0x19
# 8. 1512 Page[1] set amplitude...

sleep 0.1
#  rw 0x1c 0x19 0x0001
#  rw 0x1c 0x18 0xb416
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0001
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb416

sleep 0.1
#  rw 0x1c 0x18 0xb81a
#  rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb81a
mdio-util -m 1 -p 0x1c -r 0x19

sleep 0.1
#  rw 0x1c 0x19 0x0043
#  rw 0x1c 0x18 0xb41a
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0043
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb41a

sleep 0.1
#  rw 0x1c 0x18 0xb81a
#  rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb81a
mdio-util -m 1 -p 0x1c -r 0x19

sleep 0.1
#  rw 0x1c 0x19 0x0000
#  rw 0x1c 0x18 0xb416
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0000
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb416

# 9. 6321 set serdes OFF

sleep 0.1
#  rw 0x1c 0x19 0x0001
#  rw 0x1c 0x18 0x9596
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0001
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x9596

sleep 0.1
#  rw 0x1c 0x19 0x1940
#  rw 0x1c 0x18 0x9580
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x1940
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x9580

# 10. 6321 set to SGMII InBand modeF
#  rw 0x10 0x04 0x007c
#  rw 0x10 0x17 0x8020
#  rw 0x10 0x00 0x1e0a
#  rw 0x10 0x04 0x007f
mdio-util -m 1 -p 0x10 -w 0x04 -d 0x007c
mdio-util -m 1 -p 0x10 -w 0x17 -d 0x8020
mdio-util -m 1 -p 0x10 -w 0x00 -d 0x1e0a
mdio-util -m 1 -p 0x10 -w 0x04 -d 0x007f

# 11. 6321 set serdes ON
sleep 0.1
#  rw 0x1c 0x19 0x9140
#  rw 0x1c 0x18 0x9580
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x9140
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x9580

# 12. 6321 set amplitude ... 

sleep 0.1
#  rw 0x1c 0x19 0x0001
#  rw 0x1c 0x18 0x9596
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0001
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x9596

sleep 0.1
#  rw 0x1c 0x18 0x999a
#  rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x999a
mdio-util -m 1 -p 0x1c -r 0x19

sleep 0.1
#  rw 0x1c 0x19 0x0043
#  rw 0x1c 0x18 0x959a
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0043
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x959a

sleep 0.1
#  rw 0x1c 0x18 0x999a
#  rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0x999a
mdio-util -m 1 -p 0x1c -r 0x19










CheckBusy()
 rw 0x1c 0x19 0x0001
 rw 0x1c 0x18 0xb416

mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0001
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb416

 read Reg[0] & Reg[1]

CheckBusy()
 rw 0x1c 0x18 0xb800
 rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb800
mdio-util -m 1 -p 0x1c -r 0x19


CheckBusy()
 rw 0x1c 0x18 0xb801
 rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb801
mdio-util -m 1 -p 0x1c -r 0x19

 Set Reg[0] & Restart AN

CheckBusy()
 rw 0x1c 0x19 0x1340
 rw 0x1c 0x18 0xb400
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x1340
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb400

 read Reg[0] & Reg[1]

CheckBusy()
 rw 0x1c 0x18 0xb800
 rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb800
mdio-util -m 1 -p 0x1c -r 0x19

CheckBusy()
 rw 0x1c 0x18 0xb801
 rr 0x1c 0x19 
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb801
mdio-util -m 1 -p 0x1c -r 0x19
CheckBusy()
 rw 0x1c 0x19 0x0000
 rw 0x1c 0x18 0xb416

 
mdio-util -m 1 -p 0x1c -w 0x19 -d 0x0000
mdio-util -m 1 -p 0x1c -w 0x18 -d 0xb416